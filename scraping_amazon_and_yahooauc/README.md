## 概要
Amazonは「注文履歴」、ヤフオクは「出品終了」から情報を取得していきます。  
Amazonとヤフオクのスクレイピングは並列で行います。  
取得した情報はGoogleスプレッドシートに自動で書き込みます。

**※ Amazonでスクレイピングを行うためにはサイトにログインする必要があるのですが、robots.txtではログインページがアクセス禁止になっていますので、実装する場合は自己責任でお願いします。**



## システム環境
以下で動作確認済みです。  
OS：macOS、Windows  
Python：3系



## 実行方法
### ライブラリインストール
```
$ pip install selenium
$ pip install gspread
$ pip install oauth2client
$ pip install tqdm
```


### ChromeDriverについて
ブラウザはGoogleChromeを使用します。  
ブラウザを自動操作するためにはChromeDriverが必要です。

以下から自分のGoogleChromeと同じバージョンのドライバーをダウンロードします。  
https://sites.google.com/a/chromium.org/chromedriver/downloads

ChromeDriverをダウンロードしたら解凍して、Pythonの実行ファイルと同じ場所に配置します。


### スプレッドシートの初期設定
Pythonでスプレッドシートを操作するには初期設定が必要です。

#### プロジェクトを新規作成する
以下にアクセスして、「プロジェクトの選択」、「新しいプロジェクト」と進みます。  
https://console.cloud.google.com

「プロジェクト名」を入力し、「作成」をクリックします。

再度、「プロジェクトの選択」から今作成したプロジェクトを選択し、「開く」をクリックします。

#### 必要なAPIを有効にする
左上のハンバーガーメニューから、「APIとサービス」、「ライブラリ」と進みます。  
今回必要なAPIは「Google Drive API」と「Google Sheets API」の2つです。これらを有効にします。

#### 認証情報を設定する
ハンバーガーメニューから、「APIとサービス」、「認証情報」と進みます。  
「認証情報を作成」をクリックし、「サービスアカウント」を選択します。

「サービスアカウント名」を入力し、「作成」をクリックします。  
「ロールを選択」からロールを選択して、「続行」をクリックします。ロールは編集者でいいと思います。

最後に「完了」をクリックします。

今作成したサービスアカウントを選択し、上のタブから「キー」をクリックします。  
「鍵を追加」、「新しい鍵を作成」と進み、「作成」をクリックします。キーのタイプはJSONを選択してください。すると、JSONファイルがダウンロードできます。

このJSONファイルはPythonの実行ファイルと同じ場所に保存しておきます。

#### スプレッドシートの共有設定をする
新しいスプレッドシートを作成します。  
右上の「共有」をクリックし、先ほどダウンロードしたJSONファイルに`client_email`という項目があるので、このメールアドレスを編集者として追加します。

通知をする必要はないので、「通知」のチェックを外して、「共有」をクリックします。


### パラメータを指定
`JSON`にダウンロードしたJSONファイル名を指定します。

`SPREADSHEET_KEY`にはスプレッドシートキーを指定します。  
スプレッドシートキーとは、スプレッドシートのURLを指した名称で、以下の例だと「××××」の部分のことです。  
`https://docs.google.com/spreadsheets/d/××××/edit#gid=0`

上記2つは、`exe_amazon.py`、`exe_yahooauc.py`のそれぞれで指定してください。


### スプレッドシート事前準備
「アカウント」というシートを作成します。  
1行目にヤフオクのID、2行目にヤフオクのパスワードを指定してください。  
3行目にAmazonのメールアドレス、4行目にAmazonのパスワードを指定してください。

複数のアカウントから情報を取得したい場合は、その行に続けて記載すれば大丈夫です。

「アウトプット」というシートを作成します。  
このシートに取得した情報を書き込みます。  
ヤフオクはA〜D列、AmazonはF〜K列に書き込んでいきます。


### ユーザーエージェントを指定
`user_agent.txt`にユーザーエージェントを指定します。


### 実行
コマンドラインで実行します。  
```
$ python get_info.py
```
